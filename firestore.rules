service cloud.firestore {
  match /databases/{database}/documents {
		// User data
    match /users/{userId} {
      // Allow read and write if user's own data
    	allow read, write: if belongsTo(userId);
    }
    
    // User profile
    match /profiles/{userId} {
      // Allow write if user's own data
    	allow write: if belongsTo(userId);
			// Allow read for public - profiles only
      allow read: if true;
    }
    
		// Meta - track certain site data 
    match /site/{document} {
    	// Allow any signed in user to read/write meta
    	allow	write: if request.auth.uid != null;
      allow read: if true;
    }

	// Usernames
    match /usernames/{document} {
    	// Allow any signed in user to read/write meta
    	allow	write: if request.auth.uid != null;
      allow read: if true;
    }
  }
}

function belongsTo(userId) {
    return request.auth.uid == userId
}
